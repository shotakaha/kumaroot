# セマンティック・バージョニングしたい（``commitizen``）

```console
$ pip3 install commitizen
$ which cz
```

``commitizen``はGitを使ったバージョン管理をサポートしてくれるパッケージです。
コマンド名は``cz``です。
``cz サブコマンド``するだけで、セマンティック・バージョニングを簡単化できます。

:::{note}

同じ名前の``npm``パッケージがあります。
自分がどちらを使っているのか、混乱しないようにしましょう。

:::

## Poetryしたい

```console
$ poetry add commitizen --group dev
```

Poetryを使ってチームの開発環境を構築している場合を想定しています。
``commitizen``は開発しているパッケージでは直接使わないため、
``dev``グループに追加します。

## 初期化したい（``cz init``）

```bash
$ cd プロジェクト名
$ cz init
```

プロジェクトルートで初期化（``cz init``）して、設定ファイルを作成します。
ターミナルに表示されるダイアログにしたがって矢印キーで選択します。

Pythonパッケージを開発している場合は{file}`pyproject.toml`を設定ファイルにするとよいです。
その他の場合は、自分の好みの形式を選択すればよいと思います。
僕は{file}`.cz.toml`を選択する場合が多いです。

生成された設定ファイルは次のようになっていました。
最近のPythonパッケージは（暗黙の）ルールとして
``[tool.パッケージ名]``の下に設定を書くようになっています。
（ただの慣習なのか、それを定義したPEPが存在するかは未確認です）

```toml
[tool]
[tool.commitizen]
name = "cz_conventional_commits"
version = "0.0.1"
tag_format = "$version"
```

## コミットしたい（``cz c``）

```bash
$ git add ステージしたいファイル名
$ cz c
```

``cz``にステージするためのコマンドはありません。
編集したファイルはまず``git add``してステージします。

ステージした状態で、``git commit``の代わりに``cz c``を使います。
プロンプトが表示されるので、聞かれた内容に沿って情報を選択／入力するとコミットメッセージができあがります。

コミットメッセージのテンプレートは``cz info``もしくは``cz schema``、サンプルは``cz example``で確認できます。

## バージョンアップしたい（``cz bump``）

```bash
$ cz bump -ch -cc
```

プログラムの開発にひと区切りついたら、タグをつけましょう。
``cz bump``コマンド、これまでのコミットの内容をもとにした``semver``で
バージョン番号を更新すると同時に、タグを作成してくれます。
``-ch``オプションを使うと、{file}`CHANGELOG.md`を更新できます。
バージョンアップしたり、変更履歴をまとたりする作業はなかなか大変ですが、一発でやってくれるのでとても助かります。

```{note}
使い始めてみるとすぐに気が付くと思いますが、
バージョンアップが先か、CHANGELOGの整理が先か問題があります。
僕はバージョンアップをしてから、CHANGELOGを整理することにしています。
```

## バージョン番号を一元管理したい

```toml
[tool]
[tool.commitizen]
...
version_files = [
    "pyproject.toml:version"
    "src/__init__.py",
]
```

Pythonの場合、バージョン番号を書くファイルに決まりがありません。
``src/__init__.py``だったり、``src/__version__.py``だったり、
ひと（やチーム）によってさまざまです。

``[tool.commitizen.version_files]``を設定すると、
これらの外部ファイルにあるバージョン番号も
まとめて更新できるようになります。

```{note}

``commitizen``を使って``semver``管理ができるようになっていても、
バージョン情報が書かれたファイルが散逸していては意味がありません。
``version_files``で、関係するすべてのファイルを指定するとよいでしょう。

```
