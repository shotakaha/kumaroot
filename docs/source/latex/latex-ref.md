# 相互参照したい（`\ref`）

```latex
% ラベル（＝参照先）
\label{ラベル名}

% 参照番号を取得
\ref{ラベル名}

% 参照ページ数を取得
\pageref{ラベル名}
```

文書内で相互参照するためには、
`\label`コマンドで参照先を作成し、
`\ref`もしくは`\pageref`で参照番号を取得します。

## 章・節番号を参照したい（`ref`）

```latex
\section{相互参照したい}
\label{sec:ref}

\subsubsection{ラベルをつける}
\label{subsec:label}


% また別のセクション
相互参照については\ref{sec:ref}章に書きました。
参照先を作成するコマンドは\ref{subsec:label}節にも書きました。
```

章・節見出しを参照する場合は、
`\section`、`\subsection`コマンドのあとに`\label{ラベル名}`を定義します。
ラベル名は、`sec:`などのように接頭辞をつけておくと管理しやすいです。

```latex
\pageref{sec:ref}ページに書きました。
\pageref{subsec:label}ページに書きました。
```

また`\pageref`コマンドでページ番号を取得できます。

## 図番号したい

```latex
\begin{figure}
  \centering
  \includegraphics[オプション]{ファイル名}
  \caption{キャプション}
  \label{fig:label_name}
\end{figure}

それについては図\ref{fig:label_name}にまとめました。
```

`figure`環境の中に`\label`を定義することで、図番号を参照できます。
`\ref`自体は番号を返すため「図（もしくは Fig.）」などは自分で書く必要があります。

:::{seealso}

[newcommand](./latex-newcommand.md)で自作マクロを定義するか、
[cleveref](./latex-cleveref.md)パッケージを使うと簡単にできます。

:::

## 相互参照のしくみ

相互参照を処理するために、複数回（最低2回）のコンパイルが必要です。
そうしないと、相互参照した箇所が「??」のままになってしまいます。

なぜ複数回のコンパイルが必要なのか、
相互作用のしくみを理解しておくとよいと思います。

1回目のコンパイル
: 文書内の相互参照ラベル（`\label`）を認識し、すべてのラベルのデータなどを含む補助ファイル（`.aux`ファイル）を生成する

2回目のコンパイル
: `.aux`ファイルの内容を、メインの`.tex`ファイルと組み合わせて、ラベルの参照番号を取得する

n回目のコンパイル
: 「??」がなくなるまでコンパイルを繰り返す

このような処理は、パソコンに任せるのが一番です。
TeXLiveには`latexmk`というツールが付属しています。
簡単な設定方法は「[](latex-latexmk.md)」にまとめました。

レポートの提出直前などで急いでいるときほど、
こういったうっかりミスをしがちです。
はじめから`latexmk`を設定し、常用しておきましょう。
