# ビルドしたい（``cmake``）

```console
// プロジェクト内で作業
$ cd $G4WORK/プロジェクト
$ mkdir build
$ cd build
$ cmake ..    # CMakeList.txtがあるディレクトリを指定する
$ make -j8    # cmake -j8 --build .  でもOK
// 必要ならば make install する
```

Geant4本体と同じようにアプリケーションのビルドにも[CMake](https://cmake.org/)を使います。
自分で作るアプリケーションも、付属サンプルのように``CMakeLists.txt``を用意することが必要です。

ここでも``cmake``の作法（out-of-source）にしたがい、ビルド用のディレクトリを作成して作業します。
ディレクトリ名は任意ですが、分かりやすく``build``としました。
ビルド作業はすべてこのディレクトリで行います。

まずはじめに``CMakeLists.txt``から、``Makefile``などビルドに必要なファイルを生成します。
ビルド用ディレクトリに対して``CMakeLists.txt``は親ディレクトリにあるので``cmake ..``を実行しています。

そして``Makefile``から実行ファイルを生成します。
``Makefile``はビルド用ディレクトリの中にあるので``make -j8``を実行しています。
プロセッサ数のオプション（``-jN``）は指定した方がよいです。

実行ファイルは現在のディレクトリ（``build``）に生成されます。
プロジェクトの中でアプリケーションを実行するのがよいと思うので、ここで完了です。
もし、システム全体で使いたい場合は``make install``します。

```console
// アプリケーションを実行
$ ./実行ファイル名    # 対話モード
$ ./実行ファイル名 マクロ.mac    # バッチモード
```

アプリケーションの実行方法は「対話モード」と「バッチモード」の2種類あります。
引数なしで実行すると対話モード、
引数にマクロファイル（``.mac``）を指定するとバッチモードになります。

マクロは、対話モードで使用するコマンドをまとめたようなファイルです。
対話モードで起動するときも、同じディレクトリにある
``init_vis.mac``と``vis.mac``が読み込まれるようです。

